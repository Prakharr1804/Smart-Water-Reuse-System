<!doctype html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Dashboard - Smart Water Reuse</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"></head><body class="bg-[#F8FFFF]">
<nav class="p-4 bg-white shadow"><div class="max-w-6xl mx-auto px-4"><a href="index.html" class="font-semibold">← Home</a></div></nav>
<main class="max-w-6xl mx-auto p-6">
  <h1 class="text-2xl font-bold">Dashboard</h1>
  <p class="text-sm text-gray-600 mt-2">All saved simulations (client-side).</p>

  <div class="mt-6">
    <canvas id="summaryChart" height="120"></canvas>
  </div>

  <div class="mt-6 p-4 bg-white rounded shadow">
    <h3 class="font-semibold">Saved Simulations</h3>
    <div id="simList" class="mt-3 text-sm"></div>
    <div class="mt-4"><button id="clearAll" class="px-3 py-2 rounded border text-red-600">Clear all</button></div>
  </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function render(){
  const sims = JSON.parse(localStorage.getItem('sims')||'[]').slice().reverse();
  const cont = document.getElementById('simList'); cont.innerHTML='';
  const labels=[]; const tds=[]; const regions=[];
  sims.forEach((s,idx)=>{
    const el = document.createElement('div'); el.className='p-2 border rounded mb-2';
    el.innerHTML = `<div><strong>${s.industry}</strong> — ${s.region} — TDS: ${s.state.tds} ppm — Contamination: ${s.state.contamination}</div>
    <div class="mt-2"><button class="openSim" data-i="${s.industry}" data-r="${s.region}">Open</button> <button class="delSim" data-ts="${s.ts}">Delete</button></div>`;
    cont.appendChild(el);
    labels.push(s.industry + ' ('+s.region+')');
    tds.push(s.state.tds);
    regions.push(s.region);
  });
  document.querySelectorAll('.openSim').forEach(b=>b.addEventListener('click',e=>{
    window.open('industry.html?industry='+encodeURIComponent(e.target.dataset.i)+'&region='+encodeURIComponent(e.target.dataset.r),'_blank');
  }));
  document.querySelectorAll('.delSim').forEach(b=>b.addEventListener('click',e=>{
    const ts = e.target.dataset.ts;
    let all = JSON.parse(localStorage.getItem('sims')||'[]');
    all = all.filter(a=>a.ts != ts);
    localStorage.setItem('sims', JSON.stringify(all));
    render();
  }));
  // chart
  const ctx = document.getElementById('summaryChart').getContext('2d');
  if(window._chart) window._chart.destroy();
  window._chart = new Chart(ctx,{type:'bar',data:{labels:labels, datasets:[{label:'TDS (ppm)', data:tds, borderWidth:1}]}, options:{responsive:true, plugins:{legend:{display:false}}, scales:{x:{ticks:{maxRotation:45,minRotation:0}}}}});
}
document.getElementById('clearAll').addEventListener('click',()=>{ localStorage.removeItem('sims'); render(); alert('Cleared');});
render();
</script>
</body></html>
